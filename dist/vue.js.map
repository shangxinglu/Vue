{"version":3,"file":"vue.js","sources":["../src/core/instance/index.ts","../src/compiler/parse/parse-html.ts","../src/type/vnode.ts","../src/compiler/parse/index.ts","../src/compiler/index.ts","../src/platform/web/entry-runtime-with-compiler.ts"],"sourcesContent":["export default class Vue{\n\n}","\n// import {VNode} from 'src/type/vnode'\n// import {createVNode} from 'src/core/vdom/vnode'\nimport {HTMLTemplate} from 'src/type/compiler'\n\n// DOCTYPE标签\nconst doctypeReg = /^<!DOCTYPE [^>]+>/i\n\n// 开始标签开放正则\nconst startTagOpenReg = /^<([\\w\\-]+)/\n\n// 属性正则\nconst attributeReg = /^[\\s]+([(\\w\\-]+)[\\s]*=[\\s]*\\\"([^\"]*?)\\\"/\n\n// 自闭和标签正则\nconst unaryReg = /^\\s+\\/>/\n\n// 开始标签闭合正则\nconst startTagCloseReg = /^[\\s]*>/\n\n// 结束标签\nconst endTagReg = /^<\\/([\\w\\-]+)>/\n\n// 注释\nconst commentReg = /^<!--([\\s\\S]*?)-->/\n\n\n\ntype MatchType = Array<string>\n\n\ninterface TagAttr{\n    name:string,\n    value:string\n}\ninterface ParseOption {\n    // 开始标签hook\n    start?:(tag:string, attrs:Array<TagAttr>,isUnary:boolean ,startIndex?:number,endIndex?:number) => void,\n    // 结束标签hook\n    end?:(tag:string,startIndex?:number,endIndex?:number) => void,\n    // 文本hook\n    text?:(text:string,startIndex?:number,endIndex?:number) => void,\n    // 注释hook\n    comment?:(text:string,startIndex?:number,endIndex?:number) => void,\n}\n\n\ninterface Tag {\n    tag:string,\n    attrs:Array<TagAttr>,\n} \n\nexport function parseHTML(html:HTMLTemplate,option:ParseOption):void{\n    let startIndex:number=0,\n    endIndex:number=0,\n    index:number=0\n\n \n    \n    while(html){\n        // DOCTYPE标签\n        if(doctypeReg.test(html)){\n            const match = (html.match(doctypeReg)) as MatchType\n            crop(match[0])\n            continue\n            \n        }\n\n        // 注释\n        if(commentReg.test(html)){\n            const match = (html.match(commentReg.source)) as MatchType\n            crop(match[0])\n            \n            option.comment?.(match[1],startIndex,endIndex)\n            continue\n        }\n\n        // 开始标签\n        if(startTagOpenReg.test(html)){\n            const tagObj:Tag = {\n                tag:'',\n                attrs:[]\n            }\n           const match = (html.match(startTagOpenReg)) as MatchType\n             crop(match[0])\n             tagObj.tag = match[1]\n             parseTagAttr(tagObj)\n            continue\n        }\n\n        // 闭合标签\n        if(endTagReg.test(html)){\n            const match = (html.match(endTagReg)) as MatchType\n            crop(match[0])\n            option.end?.(match[1],startIndex,endIndex)\n            continue\n        }\n\n        /**\n         * 以上正则都不满足，则为文本\n         */\n        if(html.includes('<')){\n            const i = html.indexOf('<')\n            const text = html.slice(0,i)\n            crop(text) \n            if(['','\\n'].includes(text)) continue\n            option.text?.(text,startIndex,endIndex)\n            continue\n        }\n\n        crop(html)\n    }\n\n    // 匹配标签属性\n    function parseTagAttr(tagObj:Tag):void{\n\n        while(attributeReg.test(html)){\n            const match = (html.match(attributeReg)) as MatchType\n            crop(match[0])\n            const attrObj:TagAttr = {\n                name:match[1],\n                value:match[2]||''\n            }\n            tagObj.attrs.push(attrObj)\n        }\n        parseTagClose(tagObj)\n    }\n\n    // 匹配标签闭合\n    function parseTagClose(tagObj:Tag){\n        if(startTagCloseReg.test(html)){\n            const match = (html.match(startTagCloseReg)) as MatchType\n            crop(match[0])\n            option.start?.(tagObj.tag,tagObj.attrs,false,startIndex,endIndex)\n        }\n        if(unaryReg.test(html)){\n            option.start?.(tagObj.tag,tagObj.attrs,true,startIndex,endIndex)\n        }\n            \n    }\n\n    // 剪裁html中已经匹配的字符串\n    function crop(str:string){\n        // console.log(str);\n        \n        const len = str.length\n        html = html.substring(len)\n        startIndex = index\n        index+=len\n        endIndex = index\n        // console.log(startIndex,endIndex,index);\n    }\n\n    \n\n}\n\n","\nexport enum VNodeType {\n    ELEMENT = 1, // 元素节点\n    TEXT = 3, // 文本节点\n    COMMENT = 8, // 注释节点\n}\n\n// 虚拟节点\nexport interface VNode {\n    tag: string,\n    attrArr: Array<object>,\n    children:Array<VNode>,\n    text:string,\n    comment:string\n}","import {parseHTML} from './parse-html'\nimport {HTMLTemplate} from 'src/type/compiler'\nimport { VNodeType} from 'src/type/vnode';\n\n\ninterface ASTVNode{\n    type:VNodeType,\n    tag?:string,\n    attrs?:Array<object>,\n    text?:string,   \n}\n\ninterface ASTElement{\n    type:VNodeType.ELEMENT,\n    tag:string,\n    attrs:Array<object>,\n    children:Array<ASTVNode>,\n    parent?:ASTElement|null,\n}\n\n/**\n * @description 创建抽象语法树节点\n */\nfunction createASTElement(tag: string, attrs: any, parent: ASTElement|null):ASTElement {\n    return {\n        type:VNodeType.ELEMENT,\n        tag,\n        attrs,\n        children: [],\n        parent,\n    }\n}\n\n// 创建抽象文本节点\nfunction createASTText(text: string):ASTVNode {\n  return {\n    type:VNodeType.TEXT,\n    text,\n  } \n}\n\n\n\nexport function parse(template:HTMLTemplate){\n    const stack:ASTElement[] = []\n    parseHTML(template,{\n        start(tag,attrs,isUnary){\n            console.log('start',tag,attrs);\n            const currentNode = stack[stack.length-1]||null\n            const newNode = createASTElement(tag,attrs,currentNode)\n            stack.push(newNode)\n            if(!currentNode) {\n                if(isUnary) {\n                    stack.pop()\n                }\n                return\n            }\n            currentNode.children.push(newNode)\n            if(isUnary) {\n                stack.pop()\n            }\n        },\n        end(tag){\n            console.log('end',tag);\n            stack.pop()\n        },\n        // comment(text){\n        //    console.log('comment',text);\n\n        // },\n        text(text){\n            console.log('text',text);\n            const currentNode = stack[stack.length-1]||null\n            if(!currentNode) return\n            const newNode = createASTText(text)\n            currentNode.children.push(newNode)\n            \n        }   \n    })\n\n    return stack\n}\n\n","\nimport {HTMLTemplate} from 'src/type/compiler'\nimport {parse} from './parse'\n\n\nexport function compiler(template:HTMLTemplate):void{\n    const ast = parse(template)\n    console.log('ast',ast);\n    \n}\n","import Vue from './runtime/index'\nimport { compiler } from 'src/compiler'\n\n(Vue as any).compiler = compiler\nexport default Vue"],"names":[],"mappings":"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"}